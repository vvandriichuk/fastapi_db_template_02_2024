# FastAPI + SQL Template from 02.2024

[![Build Status](https://github.com/vvandriichuk/fastapi_db_template_02_2024/actions/workflows/checks.yml/badge.svg?branch=main)](https://github.com/vvandriichuk/fastapi_db_template_02_2024/actions/workflows/checks.yml)

This my current vision of the good FastAPI structure.

Short description of this structure and changes:

v.2.2.0 (from 29.02.2024) - Unit tests:
-
-  Using TDD methodology added unit tests for all endpoints

v.2.1.0 (from 29.02.2024) - Additional checker and GitHub actions:
-
- Added mypy checker
- Added actions for GitHub

v.2.0.0 (from 21.02.2024) - Unit of Work:
-
- Added transaction manager to handle the database transactions

v.1.0.0 (from 15.02.2024) - Onion Architecture:
-
- Take beyond the logic from the API endpoints and put it in the middle layer
- Added SQLAlchemy models and linked them with Pydantic schemas through to_read_model
- Changed orm_mode for schemas class Config to from_attributes (for Pydantic v2)
- Added Service layer to handle the logic of the API endpoints
- Added Repository layer to handle the logic of the database (based on dependency inversion principle from SOLID principles)

TODO:

- Add tests
- Add abstract class for choosing DB
- Add PostgreSQL database
- Add logger


1. For autogenerated migration files for updating DB, run (NB! you need to add paths to models to the migrations/env file if you want to autogenerate migration successfully (as this moment I don't know why)):

```
alembic revision --autogenerate -m "description_of_changes"

```

2. For running the migration, run:

```
alembic upgrade head
```

3. For running check of the code with Ruff, run:

```
ruff check app
```

4. For running the formatting of the code with the Ruff, run:

```
ruff format app
```

5. For checking the code with Mypy, run:

```
poetry run mypy app/
```

6. For running pytest, use commands from directory:

```
cd app
poetry run pytest . -v
```

7. For running this project locally from root dir, run (you can use any port that you want):
```
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001
```

8. Before running the project in docker create docker network:

```
docker network create test-fastapi-sql-network
```
9. Run the project in docker:

```
docker-compose up --build
```

